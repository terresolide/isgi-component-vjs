function shadeColor(a,n){var r=parseInt(a.slice(1),16),i=n<0?0:255,t=n<0?-1*n:n,e=r>>16,s=r>>8&255,o=255&r;return"#"+(16777216+65536*(Math.round((i-e)*t)+e)+256*(Math.round((i-s)*t)+s)+(Math.round((i-o)*t)+o)).toString(16).slice(1)}Array.prototype.get=function(a){var n=0;for(find=!1;!find&&n<this.length;)this[n].name==a&&(find=this[n].content),n++;return find};var isgi=isgi||{};isgi.infos={aa:{name:"aa",unit:"nT",color:"#336699",url:"http://isgi.unistra.fr/indices_aa.php"},am:{name:"am",unit:"nT",color:"#cc33cc",url:"http://isgi.unistra.fr/indices_am.php"},Kp:{name:"Kp",unit:"2nT",color:"#339933",url:"http://isgi.unistra.fr/indices_kp.php"},Dst:{name:"Dst",unit:"nT",color:"#ff6633",url:"http://isgi.unistra.fr/indices_dst.php"},PC:{name:"PC",unit:"mV/m",color:"#3366ff",url:"http://isgi.unistra.fr/indices_pc.php"},AE:{name:"AE",unit:"nT",color:"#ff0000",url:"http://isgi.unistra.fr/indices_ae.php"},CKdays:{name:"CKdays",unit:"",color:"#32CD32",url:"http://isgi.unistra.fr/events_ckdays.php"},Qdays:{name:"Qdays",unit:"",color:"#ff0000",url:"http://isgi.unistra.fr/events_qdays.php"},SC:{name:"SC",unit:"",color:"#669933",url:"http://isgi.unistra.fr/events_sc.php"},SFE:{name:"SFE",unit:"",color:"#FF8000",url:"http://isgi.unistra.fr/events_sfe.php"},asigma:{name:"a&sigma;",unit:"nT",color:"",url:"http://isgi.unistra.fr/indices_asigma.php"}},isgi.colors={red:"#DB1702",green:"#32CD32",ckgreen:"#00cc00",kpgreen:"#339933",grey:"#929292",dawn:"#32cd32",noon:"#ff3333",dusk:"#6666ff",midnight:"#ff8000"},isgi.colors.lightgreen=shadeColor(isgi.colors.green,-.2),["dawn","noon","dusk","midnight"].forEach(function(a){isgi.colors[a+"_P"]=shadeColor(isgi.colors[a],.3)}),isgi.CK=["CC","KC","CK","KK","C-","K-","-C","-K"],isgi.CK2tooltip=function(a,n){var r=a.substr(0,1),i=a.substr(1,1);return s='<br /><span style="color:'+n+';">▬</span> CK24 : '+r,s+='<br /><span style="color:'+n+';">▬</span> CK48 : '+i,s};var i=0;isgi.CK.forEach(function(a){isgi.colors[a]=shadeColor(isgi.colors.ckgreen,.1*i),i++}),isgi.indices=function(){var a={};for(var n in isgi.infos)a[n]=isgi.infos[n].name;return a},isgi.name2index=function(a){return"a&sigma;"==a?"asigma":a},isgi.kp2value=function(a){if("string"!=typeof a)return 0;var n=parseInt(a.charAt(0));switch(a.charAt(1)){case"+":n+=.333;break;case"-":n-=.333}return n},isgi.getKpName=function(a){for(var n in a)if(/^Kp[a-z]?$/.test(n))return n;return null},isgi.getUrl=function(a){return a.result.meta.get("isgi_url")},isgi.tr={fr:{provisional:"provisoire",provisional_data:"Données provisoires",dawn:"dawn",noon:"noon",dusk:"dusk",midnight:"midnight",dawn_P:"dawn provisoire",noon_P:"noon provisoire",dusk_P:"dusk provisoire",midnight_P:"midnight provisoire"},en:{provisional:"provisional",provisional_data:"Provisional Data",dawn:"dawn",noon:"noon",dusk:"dusk",midnight:"midnight",dawn_P:"provisional dawn",noon_P:"provisional noon",dusk_P:"provisional dusk",midnight_P:"provisional midnight"}},isgi.Collection=function(a,n,r,i){this.indice=n,this.nameindice="Kp"==n?"ap":n,this.id=r,this.kp=isgi.getKpName(a.result.collection[0]),this.chart=null,this.error=null,this.colors=new Array;var t=this,e=!1;function s(a,n){a.hidden=new Array;var r=Date.parse(n.start+"T00:00:00.000Z");a.hidden.push([r,0]),r+=864e5,a.hidden.push([r,0]);r=Date.parse(n.end+"T23:59:00.000Z");return a.hidden.push([r,0]),a}!function(a){"Kp"==t.indice?t.colors[0]=isgi.colors.kpgreen:t.colors[0]=Highcharts.getOptions().colors[a];t.colors[0]=isgi.infos[t.id].color,t.colors[1]=shadeColor(t.colors[0],-.2),t.colors[2]=shadeColor(t.colors[0],.1)}(r),this.data=function(a){switch(t.id){case"PC":var n=function(a){var n=new Array;return n.PCN=new Array,n.PCS=new Array,a.result.collection.forEach(function(a){var r=Date.parse(a.DATE+"T"+a.TIME+"Z");a.PCS&&n.PCS.push([r,a.PCS]),a.PCN&&n.PCN.push([r,a.PCN])}),n=s(n,a.query)}(a);break;case"SC":case"SFE":var n=function(a){var n=new Array,r=a.result,i=a.result.meta.get("no_data");e=a.result.meta.get("provisional"),n[t.indice]=new Array,n.noData=new Array,e&&(n.PROVI=new Array);if(r.collection.forEach(function(a){var r=Date.parse(a.DATE+"T"+a.TIME+"Z");a.PROVI?n.PROVI.push([r,1]):n[t.indice].push([r,1])}),(0==r.collection.length||r.collection[r.collection.length-1].DATE<a.query.end)&&i){var o=Date.parse(i);n.noData=new Array,n.noData.push([o,1]);var o=Date.parse(a.query.end+"T23:59:00.000Z");n.noData.push([o,1])}return n=s(n,a.query)}(a);break;case"CKdays":var n=function(a){var n=new Array;isgi.CK.forEach(function(a){n[a]=new Array});var r=a.result,i=a.result.meta.get("no_data");if(r.collection.forEach(function(a){var r=Date.parse(a.DATE+"T12:00:00.000Z"),i=a.CK24+a.CK48;n[i].push([r,1])}),r.collection[r.collection.length-1].DATE<a.query.end&&i){var t=Date.parse(i);n.noData=new Array,n.noData.push([t,1]);var t=Date.parse(a.query.end+"T23:59:00.000Z");n.noData.push([t,1])}return n=s(n,a.query)}(a);break;case"Qdays":var n=function(a){var n=new Array;n.Qdays=new Array,n.Ddays=new Array;var r=a.result,i=a.result.meta.get("no_data");if(r.collection.forEach(function(a){var r=Date.parse(a.DATE+"T12:00:00.000Z");a.DAYS.indexOf("D")>=0?n.Ddays.push([r,1]):a.DAYS.indexOf("Q")>=0&&n.Qdays.push([r,1])}),r.collection[r.collection.length-1].DATE<a.query.end&&i){var t=Date.parse(i);n.noData=new Array,n.noData.push([t,1]);var t=Date.parse(a.query.end+"T23:59:00.000Z");n.noData.push([t,1])}return n=s(n,a.query)}(a);break;case"asigma":var n=function(a){var n=new Array;return["dawn","noon","dusk","midnight","dawn_P","noon_P","dusk_P","midnight_P"].forEach(function(a){n[a]=new Array}),a.result.collection.forEach(function(a){var r=Date.parse(a.DATE+"T"+a.TIME+"Z");["dawn","noon","dusk","midnight","dawn_P","noon_P","dusk_P","midnight_P"].forEach(function(i){a[i]&&n[i].push([r,a[i]])})}),n=s(n,a.query)}(a);break;default:var n=function(a){var n=new Array;n.indice=new Array,t.kp&&(n.kp=new Array);return a.result.collection.forEach(function(a){var r=Date.parse(a.DATE+"T"+a.TIME+"Z");n.indice.push([r,a[t.nameindice]]),t.kp&&n.kp.push([r,isgi.kp2value(a[t.kp])])}),n=s(n,a.query)}(a)}return n}(a),this.createChart=function(a,n){var r;this.chart=Highcharts.chart(a,{chart:function(a){var n={height:230,width:a,defaultSeriesType:"areaspline",plotBorderColor:"#666666",plotBorderWidth:1};return["SC","SFE"].indexOf(t.indice)>=0&&(n.type="column"),n}(n),title:{text:"",align:"float"},legend:{enabled:!1},plotOptions:(r={series:{stacking:"normal",pointPadding:0,groupPadding:0,borderWidth:1}},["SC","SFE"].indexOf(t.indice)>=0&&(r.column={pointWidth:4}),r),xAxis:{type:"datetime",lineColor:"#666",tickLength:5,dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e %b %Y",week:"%e. %b",month:"%b %y",year:"%Y"},crosshair:!0},yAxis:function(){var a=new Array;switch(t.id){case"PC":var n='<span style="color:'+t.colors[1]+'"><b>PCN</b></span> / <span style="color:'+isgi.colors.red+';"><b>PCS</b></span> ('+isgi.infos.PC.unit+")";a.push({title:{useHTML:!0,text:n}});break;case"SC":case"SFE":n="",n+='<span style="color:'+t.colors[1]+';"><b>'+t.indice+"</b></span> ",e&&(n+=' / <span style="color:'+isgi.colors.grey+';"><b>'+isgi.tr[i].provisional_data+"</b></span> "),a.push({title:{useHTML:!0,text:n},min:0,max:1,tickInterval:1});break;case"CKdays":n='<span style="color:'+t.colors[0]+';"><b>CK24</b></span> / <span style="color:'+t.colors[0]+'"><b>CK48</b></span>',a.push({title:{useHTML:!0,text:n},min:0,max:1,tickInterval:1});break;case"Qdays":n='<span style="color:'+isgi.colors.red+';"><b>Ddays</b></span> / <span style="color:'+isgi.colors.green+'"><b>Qdays</b></span>',a.push({title:{useHTML:!0,text:n},min:0,max:1,tickInterval:1});break;case"asigma":n="",["dawn","noon","dusk","midnight"].forEach(function(a){n+='<span style="color:'+isgi.colors[a]+';"><b>'+a+"</b></span> "}),n+="("+isgi.infos[t.id].unit+")",a.push({title:{useHTML:!0,text:n}});break;case"Kp":case"am":case"aa":t.kp&&a.push({title:{text:t.kp,style:{color:t.colors[2],fontWeight:"bold"}},minorTickInterval:2,tickLength:10,max:9,opposite:!0});default:a.unshift({title:{useHTML:!0,text:'<span style="color:'+t.colors[1]+'"><b>'+t.nameindice+"</b></span> ("+isgi.infos[t.id].unit+")"}})}return a}(),tooltip:function(){var a={shared:!0,crosshairs:[!0,!1,!1]};switch(t.indice){case"CKdays":a.borderColor="#ccc",a.formatter=function(){var a=Highcharts.dateFormat("%e %b %Y",this.x);return this.points.forEach(function(n,r){n.y>0&&(a+=isgi.CK2tooltip(n.series.name,n.series.color))}),a};break;case"Qdays":a.borderColor="#ccc",a.formatter=function(){var a=Highcharts.dateFormat("%e %b %Y",this.x);return this.points.forEach(function(n,r){n.y>0&&(a+='<br/><span style="color:'+n.series.color+'">▬</span> '+n.series.name)}),a};break;case"SC":case"SFE":a.formatter=function(){var a=Highcharts.dateFormat("%e %b %Y %H:%M",this.x);return this.points.forEach(function(n,r){"hidden"!=n.series.name&&(a+='<br/><span style="color:'+n.series.color+'">▬</span> '+n.series.name)}),a};break;default:a.formatter=function(){var a=Highcharts.dateFormat("%e %b %Y %H:%M",this.x);return this.points.forEach(function(n,r){"hidden"!=n.series.name&&(a+='<br/><span style="color:'+n.series.color+'">▬</span> '+n.series.name+": "),"column"==n.series.type?(n.y-Math.floor(n.y)==0&&(a+=Math.floor(n.y)+"o"),n.y-Math.floor(n.y)>0&&n.y-Math.floor(n.y)<.4&&(a+=Math.floor(n.y)+"+"),n.y-Math.floor(n.y)>.6&&(a+=Math.round(n.y)+"-")):a+=n.y}),a}}return a}(),series:function(){var a=new Array;switch(t.id){case"PC":a.push({type:"line",name:"PCN",color:t.colors[1],data:t.data.PCN}),a.push({type:"line",name:"PCS",color:isgi.colors.red,data:t.data.PCS});break;case"asigma":["dawn","noon","dusk","midnight","dawn_P","noon_P","dusk_P","midnight_P"].forEach(function(n){t.data[n]&&t.data[n].length>0&&a.push({type:"line",name:isgi.tr[i][n],color:isgi.colors[n],data:t.data[n]})});break;case"SC":case"SFE":t.data[t.indice].length>0&&a.push({name:t.indice,color:t.colors[2],data:t.data[t.indice]}),e&&t.data.PROVI.length>0&&a.push({name:t.id+" "+isgi.tr[i].provisional,color:isgi.colors.grey,data:t.data.PROVI}),t.data.noData.length&&a.push({name:"no data",type:"area",color:"#cccccc",data:t.data.noData});break;case"CKdays":isgi.CK.forEach(function(n){t.data[n].length>0&&a.push({name:n,type:"column",color:isgi.colors[n],data:t.data[n],stack:"CKDays"})}),t.data.noData&&a.push({name:"no data",type:"area",color:"#cccccc",data:t.data.noData});break;case"Qdays":a.push({name:"Ddays",type:"column",color:isgi.colors.red,data:t.data.Ddays,stack:"Days"}),a.push({name:"Qdays",type:"column",color:isgi.colors.green,data:t.data.Qdays,stack:"Days"}),t.data.noData&&a.push({name:"no data",type:"area",color:"#cccccc",data:t.data.noData});break;case"Kp":case"aa":case"am":t.kp&&a.push({type:"column",name:t.kp,color:t.colors[2],yAxis:1,zIndex:1,data:t.data.kp});default:a.unshift({type:"line",name:t.nameindice,color:t.colors[1],zIndex:2,data:t.data.indice})}return t.data.hidden.length&&a.push({name:"hidden",color:"rgba(255, 255, 255, 0.1)",data:t.data.hidden}),a}()})},this.resizeChart=function(a){if(this.chart){var n=this.chart.height;this.chart.setSize(a,n,!0)}},this.destroy=function(){return this.data=null,this.indice=null,this.error=null,this.kp=null,this.colors=null,this.chart&&(this.chart.destroy(),this.chart=null),null}};